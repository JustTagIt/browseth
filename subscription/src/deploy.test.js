const Browseth = require('browseth').default;
const abi = [
  {
    constant: true,
    inputs: [],
    name: 'name',
    outputs: [{ name: '', type: 'string' }],
    payable: false,
    stateMutability: 'view',
    type: 'function',
  },
  {
    constant: true,
    inputs: [{ name: '_tokenId', type: 'uint256' }],
    name: 'getApproved',
    outputs: [{ name: '', type: 'address' }],
    payable: false,
    stateMutability: 'view',
    type: 'function',
  },
  {
    constant: false,
    inputs: [
      { name: '_to', type: 'address' },
      { name: '_tokenId', type: 'uint256' },
    ],
    name: 'approve',
    outputs: [],
    payable: false,
    stateMutability: 'nonpayable',
    type: 'function',
  },
  {
    constant: true,
    inputs: [{ name: '_tokenId', type: 'uint256' }],
    name: 'expiresAt',
    outputs: [{ name: '_timestamp', type: 'uint256' }],
    payable: false,
    stateMutability: 'view',
    type: 'function',
  },
  {
    constant: true,
    inputs: [],
    name: 'totalSupply',
    outputs: [{ name: '', type: 'uint256' }],
    payable: false,
    stateMutability: 'view',
    type: 'function',
  },
  {
    constant: false,
    inputs: [
      { name: '_from', type: 'address' },
      { name: '_to', type: 'address' },
      { name: '_tokenId', type: 'uint256' },
    ],
    name: 'transferFrom',
    outputs: [],
    payable: false,
    stateMutability: 'nonpayable',
    type: 'function',
  },
  {
    constant: true,
    inputs: [
      { name: '_owner', type: 'address' },
      { name: '_index', type: 'uint256' },
    ],
    name: 'tokenOfOwnerByIndex',
    outputs: [{ name: '', type: 'uint256' }],
    payable: false,
    stateMutability: 'view',
    type: 'function',
  },
  {
    constant: true,
    inputs: [{ name: '_subscriptionLength', type: 'uint256' }],
    name: 'getAmountFromTime',
    outputs: [{ name: '_amount', type: 'uint256' }],
    payable: false,
    stateMutability: 'view',
    type: 'function',
  },
  {
    constant: false,
    inputs: [],
    name: 'unpause',
    outputs: [],
    payable: false,
    stateMutability: 'nonpayable',
    type: 'function',
  },
  {
    constant: false,
    inputs: [
      { name: '_from', type: 'address' },
      { name: '_to', type: 'address' },
      { name: '_tokenId', type: 'uint256' },
    ],
    name: 'safeTransferFrom',
    outputs: [],
    payable: false,
    stateMutability: 'nonpayable',
    type: 'function',
  },
  {
    constant: true,
    inputs: [{ name: '_tokenId', type: 'uint256' }],
    name: 'exists',
    outputs: [{ name: '', type: 'bool' }],
    payable: false,
    stateMutability: 'view',
    type: 'function',
  },
  {
    constant: true,
    inputs: [{ name: '_index', type: 'uint256' }],
    name: 'tokenByIndex',
    outputs: [{ name: '', type: 'uint256' }],
    payable: false,
    stateMutability: 'view',
    type: 'function',
  },
  {
    constant: false,
    inputs: [{ name: '_priceCurve', type: 'address' }],
    name: 'setPriceCurve',
    outputs: [],
    payable: false,
    stateMutability: 'nonpayable',
    type: 'function',
  },
  {
    constant: true,
    inputs: [],
    name: 'paused',
    outputs: [{ name: '', type: 'bool' }],
    payable: false,
    stateMutability: 'view',
    type: 'function',
  },
  {
    constant: true,
    inputs: [{ name: '_tokenId', type: 'uint256' }],
    name: 'ownerOf',
    outputs: [{ name: '', type: 'address' }],
    payable: false,
    stateMutability: 'view',
    type: 'function',
  },
  {
    constant: true,
    inputs: [{ name: '_owner', type: 'address' }],
    name: 'balanceOf',
    outputs: [{ name: '', type: 'uint256' }],
    payable: false,
    stateMutability: 'view',
    type: 'function',
  },
  {
    constant: false,
    inputs: [],
    name: 'renounceOwnership',
    outputs: [],
    payable: false,
    stateMutability: 'nonpayable',
    type: 'function',
  },
  {
    constant: false,
    inputs: [],
    name: 'pause',
    outputs: [],
    payable: false,
    stateMutability: 'nonpayable',
    type: 'function',
  },
  {
    constant: true,
    inputs: [],
    name: 'owner',
    outputs: [{ name: '', type: 'address' }],
    payable: false,
    stateMutability: 'view',
    type: 'function',
  },
  {
    constant: true,
    inputs: [],
    name: 'symbol',
    outputs: [{ name: '', type: 'string' }],
    payable: false,
    stateMutability: 'view',
    type: 'function',
  },
  {
    constant: true,
    inputs: [],
    name: 'getPriceCurve',
    outputs: [{ name: '', type: 'address' }],
    payable: false,
    stateMutability: 'view',
    type: 'function',
  },
  {
    constant: false,
    inputs: [
      { name: '_to', type: 'address' },
      { name: '_approved', type: 'bool' },
    ],
    name: 'setApprovalForAll',
    outputs: [],
    payable: false,
    stateMutability: 'nonpayable',
    type: 'function',
  },
  {
    constant: false,
    inputs: [
      { name: '_from', type: 'address' },
      { name: '_to', type: 'address' },
      { name: '_tokenId', type: 'uint256' },
      { name: '_data', type: 'bytes' },
    ],
    name: 'safeTransferFrom',
    outputs: [],
    payable: false,
    stateMutability: 'nonpayable',
    type: 'function',
  },
  {
    constant: true,
    inputs: [{ name: '_tokenId', type: 'uint256' }],
    name: 'tokenURI',
    outputs: [{ name: '', type: 'string' }],
    payable: false,
    stateMutability: 'view',
    type: 'function',
  },
  {
    constant: true,
    inputs: [
      { name: '_owner', type: 'address' },
      { name: '_operator', type: 'address' },
    ],
    name: 'isApprovedForAll',
    outputs: [{ name: '', type: 'bool' }],
    payable: false,
    stateMutability: 'view',
    type: 'function',
  },
  {
    constant: false,
    inputs: [{ name: '_newOwner', type: 'address' }],
    name: 'transferOwnership',
    outputs: [],
    payable: false,
    stateMutability: 'nonpayable',
    type: 'function',
  },
  {
    inputs: [{ name: '_priceCurve', type: 'address' }],
    payable: false,
    stateMutability: 'nonpayable',
    type: 'constructor',
  },
  { payable: true, stateMutability: 'payable', type: 'fallback' },
  { anonymous: false, inputs: [], name: 'Pause', type: 'event' },
  { anonymous: false, inputs: [], name: 'Unpause', type: 'event' },
  {
    anonymous: false,
    inputs: [{ indexed: true, name: 'previousOwner', type: 'address' }],
    name: 'OwnershipRenounced',
    type: 'event',
  },
  {
    anonymous: false,
    inputs: [
      { indexed: true, name: 'previousOwner', type: 'address' },
      { indexed: true, name: 'newOwner', type: 'address' },
    ],
    name: 'OwnershipTransferred',
    type: 'event',
  },
  {
    anonymous: false,
    inputs: [
      { indexed: true, name: '_from', type: 'address' },
      { indexed: true, name: '_to', type: 'address' },
      { indexed: false, name: '_tokenId', type: 'uint256' },
    ],
    name: 'Transfer',
    type: 'event',
  },
  {
    anonymous: false,
    inputs: [
      { indexed: true, name: '_owner', type: 'address' },
      { indexed: true, name: '_approved', type: 'address' },
      { indexed: false, name: '_tokenId', type: 'uint256' },
    ],
    name: 'Approval',
    type: 'event',
  },
  {
    anonymous: false,
    inputs: [
      { indexed: true, name: '_owner', type: 'address' },
      { indexed: true, name: '_operator', type: 'address' },
      { indexed: false, name: '_approved', type: 'bool' },
    ],
    name: 'ApprovalForAll',
    type: 'event',
  },
];

const b = new Browseth();
const bin =
  '6080604052600b805460a060020a60ff02191690553480156200002157600080fd5b506040516020806200161083398101604081815291518282018352601182527f537562736372697074696f6e546f6b656e00000000000000000000000000000060208084019182528451808601909552600385527f5355420000000000000000000000000000000000000000000000000000000000908501528251919391620000ad91600491620000fb565b508051620000c3906005906020840190620000fb565b5050600b805433600160a060020a031991821617909155600c8054909116600160a060020a03939093169290921790915550620001a0565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200013e57805160ff19168380011785556200016e565b828001600101855582156200016e579182015b828111156200016e57825182559160200191906001019062000151565b506200017c92915062000180565b5090565b6200019d91905b808211156200017c576000815560010162000187565b90565b61146080620001b06000396000f3006080604052600436106101535763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166306fdde038114610216578063081812fc146102a0578063095ea7b3146102d457806317c95709146102fa57806318160ddd1461032457806323b872dd146103395780632f745c59146103635780633878bb2d146103875780633f4ba83a1461039f57806342842e0e146103b45780634f558e79146103de5780634f6ccce71461040a5780635718ec29146104225780635c975abb146104435780636352211e1461045857806370a0823114610470578063715018a6146104915780638456cb59146104a65780638da5cb5b146104bb57806395d89b41146104d05780639609f6c7146104e5578063a22cb465146104fa578063b88d4fde14610520578063c87b56dd1461058f578063e985e9c5146105a7578063f2fde38b146105ce575b600b5460a060020a900460ff161561016a57600080fd5b600c54604080517f24b545e00000000000000000000000000000000000000000000000000000000081523460048201529051610213923392600160a060020a03909116916324b545e0916024808201926020929091908290030181600087803b1580156101d657600080fd5b505af11580156101ea573d6000803e3d6000fd5b505050506040513d602081101561020057600080fd5b505167ffffffffffffffff1642016105ef565b50005b34801561022257600080fd5b5061022b610636565b6040805160208082528351818301528351919283929083019185019080838360005b8381101561026557818101518382015260200161024d565b50505050905090810190601f1680156102925780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3480156102ac57600080fd5b506102b86004356106cd565b60408051600160a060020a039092168252519081900360200190f35b3480156102e057600080fd5b506102f8600160a060020a03600435166024356106e8565b005b34801561030657600080fd5b506103126004356107cd565b60408051918252519081900360200190f35b34801561033057600080fd5b506103126107ff565b34801561034557600080fd5b506102f8600160a060020a0360043581169060243516604435610805565b34801561036f57600080fd5b50610312600160a060020a03600435166024356108b4565b34801561039357600080fd5b50610312600435610901565b3480156103ab57600080fd5b506102f8610999565b3480156103c057600080fd5b506102f8600160a060020a0360043581169060243516604435610a11565b3480156103ea57600080fd5b506103f6600435610a49565b604080519115158252519081900360200190f35b34801561041657600080fd5b50610312600435610a66565b34801561042e57600080fd5b506102f8600160a060020a0360043516610a9b565b34801561044f57600080fd5b506103f6610abd565b34801561046457600080fd5b506102b8600435610acd565b34801561047c57600080fd5b50610312600160a060020a0360043516610af1565b34801561049d57600080fd5b506102f8610b24565b3480156104b257600080fd5b506102f8610b85565b3480156104c757600080fd5b506102b8610c02565b3480156104dc57600080fd5b5061022b610c11565b3480156104f157600080fd5b506102b8610c72565b34801561050657600080fd5b506102f8600160a060020a03600435166024351515610c81565b34801561052c57600080fd5b50604080516020601f6064356004818101359283018490048402850184019095528184526102f894600160a060020a038135811695602480359092169560443595369560849401918190840183828082843750949750610d059650505050505050565b34801561059b57600080fd5b5061022b600435610d44565b3480156105b357600080fd5b506103f6600160a060020a0360043581169060243516610df9565b3480156105da57600080fd5b506102f8600160a060020a0360043516610e27565b600d805460018101825560009182527fd7b6990105719101dabeb77144f2a3385c8033acd3af97e9423a695e81ad1eb5810183905561062f828583610805565b9392505050565b60048054604080516020601f60026000196101006001881615020190951694909404938401819004810282018101909252828152606093909290918301828280156106c25780601f10610697576101008083540402835291602001916106c2565b820191906000526020600020905b8154815290600101906020018083116106a557829003601f168201915b505050505090505b90565b600090815260016020526040902054600160a060020a031690565b60006106f382610acd565b9050600160a060020a03838116908216141561070e57600080fd5b33600160a060020a038216148061072a575061072a8133610df9565b151561073557600080fd5b6000610740836106cd565b600160a060020a031614158061075e5750600160a060020a03831615155b156107c8576000828152600160209081526040918290208054600160a060020a031916600160a060020a03878116918217909255835186815293519093918516927f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925928290030190a35b505050565b600080600d838154811015156107df57fe5b60009182526020909120015490508115156107f957600080fd5b92915050565b60085490565b806108103382610e4a565b151561081b57600080fd5b600160a060020a038416151561083057600080fd5b600160a060020a038316151561084557600080fd5b61084f8483610ea9565b6108598483610f4a565b6108638383611083565b82600160a060020a031684600160a060020a03167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040518082815260200191505060405180910390a350505050565b60006108bf83610af1565b82106108ca57600080fd5b600160a060020a03831660009081526006602052604090208054839081106108ee57fe5b9060005260206000200154905092915050565b600c54604080517f3878bb2d000000000000000000000000000000000000000000000000000000008152600481018490529051600092600160a060020a031691633878bb2d91602480830192602092919082900301818787803b15801561096757600080fd5b505af115801561097b573d6000803e3d6000fd5b505050506040513d602081101561099157600080fd5b505192915050565b600b54600160a060020a031633146109b057600080fd5b600b5460a060020a900460ff1615156109c857600080fd5b600b805474ff0000000000000000000000000000000000000000191690556040517f7805862f689e2f13df9f062ff482ad3ad112aca9e0847911ed832e158c525b3390600090a1565b80610a1c3382610e4a565b1515610a2757600080fd5b610a438484846020604051908101604052806000815250610d05565b50505050565b600090815260208190526040902054600160a060020a0316151590565b6000610a706107ff565b8210610a7b57600080fd5b6008805483908110610a8957fe5b90600052602060002001549050919050565b600c8054600160a060020a031916600160a060020a0392909216919091179055565b600b5460a060020a900460ff1681565b600081815260208190526040812054600160a060020a03168015156107f957600080fd5b6000600160a060020a0382161515610b0857600080fd5b50600160a060020a031660009081526002602052604090205490565b600b54600160a060020a03163314610b3b57600080fd5b600b54604051600160a060020a03909116907ff8df31144d9c2f0f6b59d69b8b98abd5459d07f2742c4df920b25aae33c6482090600090a2600b8054600160a060020a0319169055565b600b54600160a060020a03163314610b9c57600080fd5b600b5460a060020a900460ff1615610bb357600080fd5b600b805474ff0000000000000000000000000000000000000000191660a060020a1790556040517f6985a02210a168e66602d3235cb6db0e70f92b3ba4d376a33c0f3d9434bff62590600090a1565b600b54600160a060020a031681565b60058054604080516020601f60026000196101006001881615020190951694909404938401819004810282018101909252828152606093909290918301828280156106c25780601f10610697576101008083540402835291602001916106c2565b600c54600160a060020a031690565b600160a060020a038216331415610c9757600080fd5b336000818152600360209081526040808320600160a060020a03871680855290835292819020805460ff1916861515908117909155815190815290519293927f17307eab39ab6107e8899845ad3d59bd9653f200f220920489ca2b5937696c31929181900390910190a35050565b81610d103382610e4a565b1515610d1b57600080fd5b610d26858585610805565b610d32858585856110cc565b1515610d3d57600080fd5b5050505050565b6060610d4f82610a49565b1515610d5a57600080fd5b6000828152600a602090815260409182902080548351601f600260001961010060018616150201909316929092049182018490048402810184019094528084529091830182828015610ded5780601f10610dc257610100808354040283529160200191610ded565b820191906000526020600020905b815481529060010190602001808311610dd057829003601f168201915b50505050509050919050565b600160a060020a03918216600090815260036020908152604080832093909416825291909152205460ff1690565b600b54600160a060020a03163314610e3e57600080fd5b610e4781611255565b50565b600080610e5683610acd565b905080600160a060020a031684600160a060020a03161480610e91575083600160a060020a0316610e86846106cd565b600160a060020a0316145b80610ea15750610ea18185610df9565b949350505050565b81600160a060020a0316610ebc82610acd565b600160a060020a031614610ecf57600080fd5b600081815260016020526040902054600160a060020a031615610f465760008181526001602090815260408083208054600160a060020a031916905580518481529051600160a060020a038616927f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925928290030190a35b5050565b6000806000610f5985856112c6565b600084815260076020908152604080832054600160a060020a0389168452600690925290912054909350610f9490600163ffffffff61134e16565b600160a060020a038616600090815260066020526040902080549193509083908110610fbc57fe5b90600052602060002001549050806006600087600160a060020a0316600160a060020a0316815260200190815260200160002084815481101515610ffc57fe5b6000918252602080832090910192909255600160a060020a038716815260069091526040812080548490811061102e57fe5b6000918252602080832090910192909255600160a060020a03871681526006909152604090208054906110659060001983016113f7565b50600093845260076020526040808520859055908452909220555050565b600061108f8383611360565b50600160a060020a039091166000908152600660209081526040808320805460018101825590845282842081018590559383526007909152902055565b6000806110e185600160a060020a03166113e2565b15156110f0576001915061124c565b84600160a060020a031663f0b9e5ba8786866040518463ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004018084600160a060020a0316600160a060020a0316815260200183815260200180602001828103825283818151815260200191508051906020019080838360005b83811015611188578181015183820152602001611170565b50505050905090810190601f1680156111b55780820380516001836020036101000a031916815260200191505b50945050505050602060405180830381600087803b1580156111d657600080fd5b505af11580156111ea573d6000803e3d6000fd5b505050506040513d602081101561120057600080fd5b50517fffffffff0000000000000000000000000000000000000000000000000000000081167ff0b9e5ba0000000000000000000000000000000000000000000000000000000014925090505b50949350505050565b600160a060020a038116151561126a57600080fd5b600b54604051600160a060020a038084169216907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e090600090a3600b8054600160a060020a031916600160a060020a0392909216919091179055565b81600160a060020a03166112d982610acd565b600160a060020a0316146112ec57600080fd5b600160a060020a03821660009081526002602052604090205461131690600163ffffffff61134e16565b600160a060020a0390921660009081526002602090815260408083209490945591815290819052208054600160a060020a0319169055565b60008282111561135a57fe5b50900390565b600081815260208190526040902054600160a060020a03161561138257600080fd5b6000818152602081815260408083208054600160a060020a031916600160a060020a038716908117909155835260029091529020546113c29060016113ea565b600160a060020a0390921660009081526002602052604090209190915550565b6000903b1190565b818101828110156107f957fe5b8154818355818111156107c8576000838152602090206107c89181019083016106ca91905b80821115611430576000815560010161141c565b50905600a165627a7a7230582046f29c43216b66ad8356ae75595b1d23c9f3e34c33833a012b655aef249c4e4d0029';

b.wallet = new Browseth.Wallets.Online(b.rpc);

it('', async () => {
  console.log(eth);

  // console.log(abi);
  const transactionListener = new Browseth.Apis.TransactionListener(b.wallet);
  transactionListener.startPolling();

  b.addContract('subscription', abi, { bytecode: bin });

  const transactionHash = await b.contract.subscription
    .deploy('0xdeadcafe')
    .send();
  console.log(transactionHash);
  const transaction = await transactionListener.resolveTransaction(
    transactionHash,
  );

  console.log(transaction);
});
